---
title: "MODELOS LINEARES GENERALIZADOS (EST082)"
subtitle: "LISTA 2 - Dados contínuos e positivos"
lang: pt
author: "Jaqueline Lamas da Silva"
knitr:
    opts_chunk: 
      fig.align: 'center'
format: 
  html:
    self-contained-math: true
    embed-resources: true
    code-fold: true
toc: true
editor: source
---


```{r, echo=FALSE, warning=FALSE}
rm(list = ls(all = TRUE))
suppressMessages(library("dplyr"))
suppressMessages(library("MASS"))
suppressMessages(library("readr"))
source("MLG/Funcoes/StepBackwardF.R")
source('MLG/Funcoes/envelope.r')

cores<-c("#BAF3DE","#C9E69E","#FFC29A","#FF9B95")


```

# Exercício 7

```{r}
suppressMessages(vidros <- read_table("dados/lista2/vidros.txt", 
    col_names = FALSE, col_types = cols(X2 = col_factor(levels = c("1","2", "3", "4")), X3 = col_factor(levels = c("1", "2")))))
colnames(vidros)<-c("resistencia","voltagem","temperatura")

vidros<-vidros |>
  mutate(voltagem=factor(voltagem, levels = c(1:4),labels = paste0(150+c(1:4)*50,"kV")), temperatura = factor(temperatura, 1:2, labels=c("170°C","180°C")))
```


## Análise Exploratória

```{r}
suppressMessages(attach(vidros))
boxplot(resistencia~voltagem, col=cores)
```
Os vidros parecem resistir por mais tempo a voltagens menores.

```{r}
boxplot(resistencia~temperatura, col=cores)
```
A temperatura apresenta uma mediana levemente menor, ou seja, talvez os vidros sejam menos resistentes a temperaturas maiores.


## Seleção do modelo

# Normal
```{r}

envel_norm<-function(fit.model,alfa)
{
  par(mfrow=c(1,1))
  X <- model.matrix(fit.model)
  n <- nrow(X)
  p <- ncol(X)
  
  H <- X%*%solve(t(X)%*%X)%*%t(X)
  h <- diag(H)
  si <- lm.influence(fit.model)$sigma
  r <- resid(fit.model)
  tsi <- r/(si*sqrt(1-h))
  #
  ident <- diag(n)
  epsilon <- matrix(0,n,100)
  e <- matrix(0,n,100)
  e1 <- numeric(n)
  e2 <- numeric(n)
  #
  for(i in 1:100){
    epsilon[,i] <- rnorm(n,0,1)
    e[,i] <- (ident - H)%*%epsilon[,i]
    u <- diag(ident - H)
    e[,i] <- e[,i]/sqrt(u)
    e[,i] <- sort(e[,i]) }
  #
  for(i in 1:n){
    eo <- sort(e[i,])
    e1[i] <- (eo[2]+eo[3])/2
    e2[i] <- (eo[97]+eo[98])/2 }
  #
  med <- apply(e,1,mean)
  faixa <- range(tsi,e1,e2)
  #
  par(pty="s")
  pp=qqnorm(tsi,xlab="Percentis da N(0,1)",
            ylab="Residuo Studentizado", ylim=faixa, pch=16)
  par(new=T)
  qqnorm(e1,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=1)
  par(new=T)
  qqnorm(e2,axes=F,xlab="",ylab="", type="l",ylim=faixa,lty=1)
  par(new=T)
  qqnorm(med,axes=F,xlab="",ylab="",type="l",ylim=faixa,lty=2)
  
  ind <- numeric(n)
  ind <- sort(tsi)<sort(e1) | sort(tsi)>sort(e2)
  prop.fora<-sum(ind)/n
  qualidade<-NULL
  if(prop.fora==0)
  {
    qualidade<-"Ótimo"
  }else if(prop.fora>0 & prop.fora<alfa/2)
  {
    qualidade<-"Bom"
  } else if((prop.fora>=alfa/2 & prop.fora<=alfa))
  {
    qualidade<-"Razoável"
    
  }else if((prop.fora>alfa))
  {
    qualidade<-"Ruim"
  }
  return(list(qualidade, plot_capturado))
}


resultado<-function()
{
  meu.amb<-new.env()
  n<-nrow(vidros)
  modelo<-resistencia ~ voltagem + temperatura
  fit1<- glm(modelo, family=gaussian)
  fit.model<-stepAIC(fit1,k=log(n), trace = 0)
  grafico()
  # teste<-try(source("MLG/Funcoes/envel_norm.txt"))
}
resultado()
  
```










